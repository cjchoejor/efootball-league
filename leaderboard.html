<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard - eFootball League</title>
    <link rel="icon" type="image/png" href="logo2.png">
    <link rel="stylesheet" href="src/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-futbol"></i>
                eFootball League
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="tournament.html" class="nav-link">Tournaments</a>
                <a href="past-tournaments.html" class="nav-link">Past Tournaments</a>
                <a href="players.html" class="nav-link">Players</a>
                <a href="leaderboard.html" class="nav-link active">Leaderboard</a>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <h2 class="section-title">All-Time Leaderboard</h2>
        
        <div class="stats-overview" id="statsOverview">
            <!-- Stats overview will be loaded here -->
        </div>

        <div class="leaderboard-container">
            <div class="leaderboard-table">
                <div class="table-header">
                    <div class="table-row">
                        <div>Player</div>
                        <div>Tournaments</div>
                        <div>Wins</div>
                        <div>Matches</div>
                        <div>Goals</div>
                        <div>Win %</div>
                        <div>Points</div>
                    </div>
                </div>
                <div class="table-body" id="leaderboardBody">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading leaderboard...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="src/js/cache.js"></script>
    <script src="src/js/utils.js"></script>
    <script>
        class Leaderboard {
             constructor() {
                 this.baseUrl = '/.netlify/functions';
                 this.cacheKey = 'cache_all_time_leaderboard_full';
                 this.cacheTTL = 5 * 60 * 1000; // 5 minutes
                 this.init();
             }

             async init() {
                 await this.loadLeaderboard();
             }

             async loadLeaderboard() {
                 try {
                     // Check cache first
                     const cached = cache.get(this.cacheKey);
                     if (cached) {
                         console.log('Using cached leaderboard data');
                         this.renderLeaderboard(cached);
                         return;
                     }

                     const response = await fetch(`${this.baseUrl}/get-stats?type=all-time`);
                     const stats = await response.json();
                     
                     // Cache the result
                     cache.set(this.cacheKey, stats, this.cacheTTL);
                     
                     this.renderLeaderboard(stats);
                 } catch (error) {
                     console.error('Error loading leaderboard:', error);
                     document.getElementById('leaderboardBody').innerHTML = 
                         '<p class="error">Error loading leaderboard</p>';
                 }
             }

            renderLeaderboard(stats) {
                const container = document.getElementById('leaderboardBody');
                
                if (stats.length === 0) {
                    container.innerHTML = '<p class="no-data">No leaderboard data available</p>';
                    return;
                }

                container.innerHTML = stats.map((player, index) => `
                    <div class="table-row ${index < 3 ? 'top-three' : ''}" data-label="Player | Tournaments | Wins | Matches | Goals | Win % | Points">
                        <div class="player-info" data-label="Player">
                            <img src="${player.photo_url || 'src/images/default-avatar.jpg'}" 
                                 alt="${player.name}" class="player-avatar">
                            <div style="display: flex; flex-direction: column; align-items: flex-start;">
                                <span style="font-weight: 500;">${player.name}</span>
                                <span style="font-size: 0.85rem; color: var(--text-secondary);">${player.team_name}</span>
                            </div>
                        </div>
                        <div data-label="Tournaments">${player.tournaments_played || 0}</div>
                        <div data-label="Wins">${player.tournaments_won || 0}</div>
                        <div data-label="Matches">${player.total_matches || 0}</div>
                        <div data-label="Goals">${player.total_goals || 0}</div>
                        <div data-label="Win %">${player.win_percentage ? player.win_percentage.toFixed(1) + '%' : '0%'}</div>
                        <div class="points" data-label="Points">${player.total_points || 0}</div>
                    </div>
                `).join('');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new Leaderboard();
        });
    </script>
</body>
</html>